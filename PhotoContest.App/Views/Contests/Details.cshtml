@using PhotoContest.Models.Enums
@model PhotoContest.App.ViewModels.ContestDetailsViewModel
@{
    ViewBag.Title = "Details";
}

<h3>@Model.Title</h3>

@if (Model.Status == ContestStatus.Dismissed)
{
    <h2 class="text-danger"> Dismissed </h2>
}

@if (Request.IsAuthenticated &&
                Model.Creator == this.User.Identity.Name &&
                Model.ParticipationStrategy == ParticipationStrategy.Closed)
{
    @Html.Partial("_InvitationPartial")
}

<div>
    <p>@Html.DisplayNameFor(x => x.Description): @Html.DisplayFor(x => x.Description)</p>
    <p>@Html.DisplayNameFor(x => x.Creator): @Html.DisplayFor(x => x.Creator)</p>
    <p>@Html.DisplayNameFor(x => x.DateCreated): @Html.DisplayFor(x => x.DateCreated)</p>
    <p>@Html.DisplayNameFor(x => x.DateEnd): @Html.DisplayFor(x => x.DateEnd)</p>
</div>
<hr />


@if (Request.IsAuthenticated && this.ViewBag.HasUserPartisipate && (Model.Status == ContestStatus.Active || Model.Status == ContestStatus.ParticipationClosed))
{
    <h4>Upload Your photo</h4>

    using (Html.BeginForm("UploadImage", "Image", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken()
        @Html.TextBox("image", new { }, new { type = "file" })
        <input type="hidden" value="@Model.Id" name="contestId" />
        <input type="submit" class="btn btn-primary" value="Upload" />
    }
}

<div id="photos">
    <h2>Photos</h2>

    @{
        if (Model.Photos.Any())
        {
            foreach (var photo in Model.Photos)
            {
                @Html.Action("GetImage", "Image", new { photoId = photo.Id });
            }
        }
        else
        {
            <span> No photos yet. </span>
        }
    }
</div>

@section scripts
{
    <script>
        function onVoteSuccess(id) {
            var buttonDiv = $("#vote-button-" + id);
            buttonDiv.empty();
        }

        $(document).ready(function () {

            $('#search').keyup(function (e) {
                var searchQuery = $('#search').val();
                $.getJSON("/Notifications/SearchUser", {

                    query: searchQuery
                },
                function (data) {
                    var div = $('#users');
                    var ul = $('<ul>');
                    $(div).html('');
                    $.each(data, function (i, user) {
                        var li = $('<li>', { id: user.Id, text: user.UserName });
                        li.appendTo(ul);
                    });
                    ul.appendTo(div);
                })
            })
        })
    </script>
}


